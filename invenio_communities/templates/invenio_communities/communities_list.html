{#
# This file is part of WEKO3.
# Copyright (C) 2017 National Institute of Informatics.
#
# WEKO3 is free software; you can redistribute it
# and/or modify it under the terms of the GNU General Public License as
# published by the Free Software Foundation; either version 2 of the
# License, or (at your option) any later version.
#
# WEKO3 is distributed in the hope that it will be
# useful, but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
# General Public License for more details.
#
# You should have received a copy of the GNU General Public License
# along with WEKO3; if not, write to the
# Free Software Foundation, Inc., 59 Temple Place, Suite 330, Boston,
# MA 02111-1307, USA.
#}

{%- extends config.WEKO_WORKFLOW_BASE_TEMPLATE %}

{%- block css %}
  {{ super() }}
{%- endblock css %}

{%- block javascript %}
  {{ super() }}
  {%- assets "workflow_activity_list_js" %}<script src="{{ ASSET_URL }}"></script>{% endassets %}
{%- endblock javascript %}

{%- block page_body_tabs %}
  {% from "weko_theme/macros/tabs_selector.html" import tabs_selector %}
  {{ tabs_selector('flow') }}
{%- endblock page_body_tabs %}

{%- block page_body_main %}
<div class="row">
  <div class="col-sm-12">
    <table class="table table-striped table-bordered">
    <thead>
      <tr>
        <th>{{ _('No.') }}</th>
        <th>{{ _('Title') }}</th>
        <th></th>
      </tr>
    </thead>
    <tbody>
    {% if communities %}
      {%- for row in communities|batch(2) %}
        {%- for obj in row %}
        <tr class="">
          <th scope="row">{{loop.index}}</th>
          <td>{{ obj.title }}</td>
          <td>
            <div class="pull-right">
              <div class="form-group">
                <div class="dropdown">
                    <button type="button" class="btn dropdown-toggle" id="dropdownMenu_View" data-toggle="dropdown">{{ _('View') }}
                        <span class="caret"></span>
                    </button>
                    <ul class="dropdown-menu" role="menu" aria-labelledby="dropdownMenu_View">
                        <li role="presentation">
                            <a role="menuitem" tabindex="-1" href="{{url_for('.view', community_id=obj.id, view='basic')}}">{{ _('Basic') }}</a>
                        </li>
                        <li role="presentation">
                            <a role="menuitem" tabindex="-1" href="{{url_for('.view', community_id=obj.id, view='weko')}}">{{ _('Weko') }}</a>
                        </li>
                    </ul>
                </div>
              </div>
              {% if obj.id_user == current_user.id %}
                <a href="{{url_for('.curate', community_id=obj.id)}}" class="btn btn-info">{{ _('Curate') }}</a>
              {% endif %}
            </div>
          </td>
        </tr>
        {%- endfor %}
      {%- endfor %}
      {% if pagination.total_count > pagination.per_page %}
          <div align="center">
            <ul class="pagination">
              <li{{ ' class="disabled"'|safe if not pagination.has_prev }}>
                {%- set new_args = args.copy() -%}
                {%- do new_args.update({'page': 1}) -%}
                <a title="first" href="{{ url_for('.index', **new_args) }}">&laquo;</a>
              </li>
              <li{{ ' class="disabled"'|safe if not pagination.has_prev }}>
                {%- do args.update({'page': pagination.page-1 }) -%}
                <a title="prev" href="{{ url_for('.index', **args) }}">&lsaquo;</a>
              </li>
              {%- for page_p in pagination.iter_pages() %}
                {%- if page_p -%}
                  {%- set new_args = args.copy() -%}
                  {%- do new_args.update({'page': page_p}) -%}
                  <li{{ ' class="active"'|safe if page_p == pagination.page }}>
                    <a href="{{ url_for('.index', **new_args) }}">{{ page_p }}</a>
                  </li>
                {%- else -%}
                  <li class="disabled"><a href="#">...</a></li>
                {%- endif -%}
              {%- endfor -%}
              <li{{ ' class="disabled"'|safe if not pagination.has_next }}>
                {%- set new_args = args.copy() -%}
                {%- do new_args.update({'page': pagination.page+1}) -%}
                <a href="{{ url_for('.index', **new_args) }}">&rsaquo;</a>
              </li>
              <li{{ ' class="disabled"'|safe if not pagination.has_next }}>
                {%- set new_args = args.copy() -%}
                {%- do new_args.update({'page': pagination.pages }) -%}
                <a title="last" href="{{ url_for('.index', **new_args) }}">&raquo;</a>
              </li>
            </ul>
          </div>
      {% endif %}
    {% else %}
        <p class="text-muted text-center">
          <strong>{{ _('Your search did not match any communities. Please try again.') }}</strong>
        </p>
    {% endif %}
    </tbody>
    </table>
  </div>
</div>
{%- endblock page_body_main %}
